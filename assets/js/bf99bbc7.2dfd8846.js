"use strict";(self.webpackChunksenai_nosql=self.webpackChunksenai_nosql||[]).push([[5827],{3905:(o,n,e)=>{e.d(n,{Zo:()=>m,kt:()=>g});var a=e(7294);function r(o,n,e){return n in o?Object.defineProperty(o,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):o[n]=e,o}function t(o,n){var e=Object.keys(o);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(o);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(o,n).enumerable}))),e.push.apply(e,a)}return e}function s(o){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?t(Object(e),!0).forEach((function(n){r(o,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(e)):t(Object(e)).forEach((function(n){Object.defineProperty(o,n,Object.getOwnPropertyDescriptor(e,n))}))}return o}function i(o,n){if(null==o)return{};var e,a,r=function(o,n){if(null==o)return{};var e,a,r={},t=Object.keys(o);for(a=0;a<t.length;a++)e=t[a],n.indexOf(e)>=0||(r[e]=o[e]);return r}(o,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(o);for(a=0;a<t.length;a++)e=t[a],n.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(o,e)&&(r[e]=o[e])}return r}var d=a.createContext({}),c=function(o){var n=a.useContext(d),e=n;return o&&(e="function"==typeof o?o(n):s(s({},n),o)),e},m=function(o){var n=c(o.components);return a.createElement(d.Provider,{value:n},o.children)},l="mdxType",u={inlineCode:"code",wrapper:function(o){var n=o.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(o,n){var e=o.components,r=o.mdxType,t=o.originalType,d=o.parentName,m=i(o,["components","mdxType","originalType","parentName"]),l=c(e),p=r,g=l["".concat(d,".").concat(p)]||l[p]||u[p]||t;return e?a.createElement(g,s(s({ref:n},m),{},{components:e})):a.createElement(g,s({ref:n},m))}));function g(o,n){var e=arguments,r=n&&n.mdxType;if("string"==typeof o||r){var t=e.length,s=new Array(t);s[0]=p;var i={};for(var d in n)hasOwnProperty.call(n,d)&&(i[d]=n[d]);i.originalType=o,i[l]="string"==typeof o?o:r,s[1]=i;for(var c=2;c<t;c++)s[c]=e[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,e)}p.displayName="MDXCreateElement"},9126:(o,n,e)=>{e.r(n),e.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>c});var a=e(7462),r=(e(7294),e(3905));const t={id:"relacionamento-um-para-muitos",slug:"relacionamento-um-para-muitos",title:"Um para Muitos",sidebar_position:1,tags:["relacionamento","um para muitos"]},s="Relacionmento Um para Muitos em MongoDB",i={unversionedId:"nosql/MongoDB/relacionamentos/relacionamento-um-para-muitos",id:"nosql/MongoDB/relacionamentos/relacionamento-um-para-muitos",title:"Um para Muitos",description:'No MongoDB, voc\xea pode representar relacionamentos "um para muitos" (1:N) usando documentos incorporados (embedded documents) em um \xfanico documento pai. Vamos dar um exemplo de como voc\xea pode modelar um relacionamento "um para muitos" usando documentos incorporados no MongoDB.',source:"@site/docs/nosql/MongoDB/relacionamentos/um-para-muitos.mdx",sourceDirName:"nosql/MongoDB/relacionamentos",slug:"/nosql/MongoDB/relacionamentos/relacionamento-um-para-muitos",permalink:"/senai-nosql/docs/nosql/MongoDB/relacionamentos/relacionamento-um-para-muitos",draft:!1,editUrl:"https://github.com/jcristiano/senai-nosql/tree/main/docs/nosql/MongoDB/relacionamentos/um-para-muitos.mdx",tags:[{label:"relacionamento",permalink:"/senai-nosql/docs/tags/relacionamento"},{label:"um para muitos",permalink:"/senai-nosql/docs/tags/um-para-muitos"}],version:"current",sidebarPosition:1,frontMatter:{id:"relacionamento-um-para-muitos",slug:"relacionamento-um-para-muitos",title:"Um para Muitos",sidebar_position:1,tags:["relacionamento","um para muitos"]},sidebar:"nosqlSidebar",previous:{title:"Relacionamentos",permalink:"/senai-nosql/docs/category/relacionamentos"},next:{title:"Um para Muitos (Atividades)",permalink:"/senai-nosql/docs/nosql/MongoDB/relacionamentos/relacionamento-um-para-muitos-atividades"}},d={},c=[{value:"Um exemplo de uso: Rela\xe7\xe3o setores e funcionarios",id:"um-exemplo-de-uso-rela\xe7\xe3o-setores-e-funcionarios",level:2},{value:"O tipo de documento incorporado",id:"o-tipo-de-documento-incorporado",level:2},{value:"Representa\xe7\xe3o simplificada do modelo em json",id:"representa\xe7\xe3o-simplificada-do-modelo-em-json",level:2},{value:"Cria\xe7\xe3o da estrutura em MongoDB",id:"cria\xe7\xe3o-da-estrutura-em-mongodb",level:2},{value:"Inserindo os primeiros dados em nossa cole\xe7\xe3o",id:"inserindo-os-primeiros-dados-em-nossa-cole\xe7\xe3o",level:2},{value:"Ajustando a regra de valida\xe7\xe3o",id:"ajustando-a-regra-de-valida\xe7\xe3o",level:2},{value:"Agora \xe9 com voc\xea",id:"agora-\xe9-com-voc\xea",level:2},{value:"Exerc\xedcios Propostos",id:"exerc\xedcios-propostos",level:2}],m={toc:c},l="wrapper";function u(o){let{components:n,...e}=o;return(0,r.kt)(l,(0,a.Z)({},m,e,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"relacionmento-um-para-muitos-em-mongodb"},"Relacionmento Um para Muitos em MongoDB"),(0,r.kt)("p",null,'No MongoDB, voc\xea pode representar relacionamentos "um para muitos" (1:N) usando documentos incorporados (embedded documents) em um \xfanico documento pai. Vamos dar um exemplo de como voc\xea pode modelar um relacionamento "um para muitos" usando documentos incorporados no MongoDB.'),(0,r.kt)("h2",{id:"um-exemplo-de-uso-rela\xe7\xe3o-setores-e-funcionarios"},"Um exemplo de uso: Rela\xe7\xe3o setores e funcionarios"),(0,r.kt)("p",null,'Suponha que voc\xea esteja gerenciando informa\xe7\xf5es sobre setores de uma corpora\xe7\xe3o e seus funcionarios associados. Cada setor pode ter v\xe1rios funcion\xe1rios, o que se encaixa no cen\xe1rio "um setor tem muitos funcion\xe1rios" (1:N). Voc\xea pode representar isso da seguinte forma:'),(0,r.kt)("mermaid",{value:"erDiagram\n    SETORES ||--o{ FUNCIONARIOS : trabalham\n    SETORES {\n        string nome\n        string sigla        \n    }\n    FUNCIONARIOS {\n        string nome\n        string cargo\n        int modulo\n        double salario\n        date dataContratacao\n        bool ativo\n    }"}),(0,r.kt)("mermaid",{value:"graph LR  \n  Corporacao1[Empresa] ---\x3e Setor1[Recursos Humanos] --\x3e Funcionario1[Amanda Oliveira Santanna]  \n  Setor1[Recursos Humanos] --\x3e Funcionario2[Anderson Campos Monteiro]\n  Corporacao1[Empresa] ---\x3e Setor2[Marketing] --\x3e Funcionario3[Washington Marcondes Nunes]\n  Setor2[Marketing] --\x3e Funcionario4[Bruna Correia da Fonseca]\n  Corporacao1[Empresa] ---\x3e Setor3[Tecnologia e Engenharia] --\x3e Funcionario5[Pedro Antunes Silva Barros]\n  Setor3[Tecnologia e Engenharia] --\x3e Funcionario6[Caroline Gouvea do Prado]\n  Setor3[Tecnologia e Engenharia] --\x3e Funcionario7[Alisson Mendon\xe7a Pereira]"}),(0,r.kt)("h2",{id:"o-tipo-de-documento-incorporado"},"O tipo de documento incorporado"),(0,r.kt)("p",null,'No MongoDB, o tipo "embedded document" (documento incorporado) refere-se a um m\xe9todo de modelagem de dados em que documentos inteiros s\xe3o incorporados como campos em outro documento. Essa \xe9 uma das abordagens para modelar relacionamentos de dados no MongoDB, onde os dados relacionados s\xe3o armazenados dentro do documento pai em vez de criar cole\xe7\xf5es separadas com refer\xeancias cruzadas.'),(0,r.kt)("p",null,"Aqui est\xe3o algumas informa\xe7\xf5es importantes sobre documentos incorporados no MongoDB:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},'Documentos Aninhados: Os documentos incorporados s\xe3o frequentemente referidos como "documentos aninhados". Eles s\xe3o usados para representar dados relacionados dentro de um \xfanico documento.')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Vantagens:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Desempenho"),": A recupera\xe7\xe3o de dados relacionados \xe9 eficiente, pois todos os dados necess\xe1rios est\xe3o em um \xfanico documento, reduzindo a necessidade de v\xe1rias consultas."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Integridade Referencial"),": N\xe3o h\xe1 necessidade de lidar com refer\xeancias cruzadas ou manter consist\xeancia entre documentos em cole\xe7\xf5es separadas."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Atomicidade"),": As opera\xe7\xf5es de leitura e grava\xe7\xe3o em documentos incorporados s\xe3o atomicamente garantidas."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Desvantagens:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Duplica\xe7\xe3o de Dados"),": Os dados podem ser duplicados em v\xe1rios documentos, o que pode aumentar o consumo de armazenamento. Isso tamb\xe9m significa que, se os dados precisarem ser atualizados em v\xe1rios lugares, \xe9 necess\xe1rio cuidado extra para manter a consist\xeancia."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Limita\xe7\xe3o de Tamanho"),": Os documentos no MongoDB t\xeam um limite de tamanho (16 MB). Se a quantidade de dados incorporados for grande, isso pode ser uma limita\xe7\xe3o.")))),(0,r.kt)("p",null,"Quando Usar Documentos Incorporados:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},'Use documentos incorporados quando os dados relacionados s\xe3o usados principalmente em conjunto e a leitura eficiente desses dados \xe9 fundamental.\nPode ser apropriado em cen\xe1rios "um para muitos" (1:N) e "um para poucos" (1:Few) quando os "muitos" ou "poucos" n\xe3o s\xe3o excessivamente numerosos.\nQuando Evitar Documentos Incorporados:')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Evite documentos incorporados quando os dados relacionados s\xe3o usados independentemente ou precisam ser atualizados em v\xe1rias inst\xe2ncias, o que pode tornar a manuten\xe7\xe3o mais complexa.\nA escolha entre documentos incorporados e refer\xeancias cruzadas depende das necessidades espec\xedficas do seu aplicativo. O MongoDB oferece flexibilidade para modelar dados de acordo com os requisitos do seu caso de uso, permitindo que voc\xea escolha a abordagem mais adequada para cada tipo de rela\xe7\xe3o."))),(0,r.kt)("h2",{id:"representa\xe7\xe3o-simplificada-do-modelo-em-json"},"Representa\xe7\xe3o simplificada do modelo em json"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"{\n    setor,\n    funcionarios: [\n\n    ]\n}\n")),(0,r.kt)("h2",{id:"cria\xe7\xe3o-da-estrutura-em-mongodb"},"Cria\xe7\xe3o da estrutura em MongoDB"),(0,r.kt)("p",null,"Execute o procedimento de subida da inst\xe2ncia e conecte a nova base:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"use empresa;\n")),(0,r.kt)("p",null,"Agora \xe9 o momento de criar a estrutura da cole\xe7\xe3o:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'db.createCollection("setores", {\n   validator: {\n      $jsonSchema: {\n         bsonType: "object",\n         required: ["_id", "nome", "sigla", "funcionarios"],\n         properties: {\n            _id: {\n               bsonType: "int",\n               description: "ID \xfanico do setor"\n            },\n            nome: {\n               bsonType: "string",\n               description: "Nome do setor"\n            },\n            sigla: {\n               bsonType: "string",\n               description: "Sigla do setor",\n               minLength: 3,\n               maxLength: 5\n            },\n            funcionarios: {\n               bsonType: "array",\n               description: "Array de funcion\xe1rios",\n               items: {\n                  bsonType: "object",\n                  required: ["_id", "nome", "cargo", "modulo", "salario", "dataContratacao", "ativo"],\n                  properties: {\n                     _id: {\n                        bsonType: "int",\n                        description: "ID \xfanico do funcion\xe1rio"\n                     },\n                     nome: {\n                        bsonType: "string",\n                        description: "Nome do funcion\xe1rio"\n                     },\n                     cargo: {\n                        bsonType: "string",\n                        description: "Cargo do funcion\xe1rio"\n                     },\n                     modulo: {\n                        bsonType: "int",\n                        description: "M\xf3dulo do funcion\xe1rio",\n                        minimum: 0,\n                        maximum: 5\n                     },\n                     salario: {\n                        bsonType: "double",\n                        description: "Sal\xe1rio do funcion\xe1rio"\n                     },\n                     dataContratacao: {\n                        bsonType: "date",\n                        description: "Data de contrata\xe7\xe3o do funcion\xe1rio"\n                     },\n                     ativo: {\n                        bsonType: "bool",\n                        description: "Indica se o funcion\xe1rio est\xe1 ativo"\n                     }\n                  }\n               }\n            }\n         }\n      }\n   }\n});\n')),(0,r.kt)("h2",{id:"inserindo-os-primeiros-dados-em-nossa-cole\xe7\xe3o"},"Inserindo os primeiros dados em nossa cole\xe7\xe3o"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'db.setores.insertMany([\n    {\n        _id: 1,\n        nome: "Recursos Humanos",\n        sigla: "RH",\n        funcionarios: [\n            {\n                _id: 1,\n                nome: "Amanda Oliveira Santanna",\n                cargo: "Analista de Recursos Humanos",\n                modulo: 1,\n                salario: 5034.45,\n                dataContratacao: new ISODate("2020-05-18"),\n                ativo: true,\n            },\n            {\n                _id: 2,\n                nome: "Anderson Campos Monteiro",\n                cargo: "Analista de Recursos Humanos",\n                modulo: 3,\n                salario: 12311.26,\n                dataContratacao: new ISODate("2011-10-01"),\n                ativo: false\n            },        \n        ]\n    },\n    {\n        _id: 2,\n        nome: "Marketing",\n        sigla: "MKT",\n        funcionarios: [\n            {\n                _id: 3,\n                nome: "Washington Marcondes Nunes",\n                cargo: "Analista de Marketing",\n                modulo: 1,\n                salario: 6436.41,\n                dataContratacao: new ISODate("2015-06-12"),\n                ativo: true\n            },\n            {\n                _id: 4,\n                nome: "Bruna Correia da Fonseca",\n                cargo: "Analista de Marketing",\n                modulo: 2,\n                salario: 8122.13,\n                dataContratacao: new ISODate("2013-05-30"),\n                ativo: true\n            },        \n        ]\n    }\n]);\n')),(0,r.kt)("h2",{id:"ajustando-a-regra-de-valida\xe7\xe3o"},"Ajustando a regra de valida\xe7\xe3o"),(0,r.kt)("p",null,"Ao tentar inserir dados na cole\xe7\xe3o, \xe9 poss\xedvel identificar que a sigla RH n\xe3o atende o crit\xe9rio de tamanho do campo."),(0,r.kt)("p",null,"N\xe3o existe uma maneira de aplicar um update no schema validator, mas \xe9 poss\xedvel remov\xea-lo e inclu\xed-lo nomvanete:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'db.runCommand({\n    collMod: "setores",\n    validator: {\n      $jsonSchema: {\n         bsonType: "object",\n         required: ["_id", "nome", "sigla", "funcionarios"],\n         properties: {\n            _id: {\n               bsonType: "int",\n               description: "ID \xfanico do setor"\n            },\n            nome: {\n               bsonType: "string",\n               description: "Nome do setor"\n            },\n            sigla: {\n               bsonType: "string",\n               description: "Sigla do setor",\n               minLength: 2,\n               maxLength: 5\n            },\n            funcionarios: {\n               bsonType: "array",\n               description: "Array de funcion\xe1rios",\n               items: {\n                  bsonType: "object",\n                  required: ["_id", "nome", "cargo", "modulo", "salario", "dataContratacao", "ativo"],\n                  properties: {\n                     _id: {\n                        bsonType: "int",\n                        description: "ID \xfanico do funcion\xe1rio"\n                     },\n                     nome: {\n                        bsonType: "string",\n                        description: "Nome do funcion\xe1rio"\n                     },\n                     cargo: {\n                        bsonType: "string",\n                        description: "Cargo do funcion\xe1rio"\n                     },\n                     modulo: {\n                        bsonType: "int",\n                        description: "M\xf3dulo do funcion\xe1rio",\n                        minimum: 0,\n                        maximum: 5\n                     },\n                     salario: {\n                        bsonType: "double",\n                        description: "Sal\xe1rio do funcion\xe1rio"\n                     },\n                     dataContratacao: {\n                        bsonType: "date",\n                        description: "Data de contrata\xe7\xe3o do funcion\xe1rio"\n                     },\n                     ativo: {\n                        bsonType: "bool",\n                        description: "Indica se o funcion\xe1rio est\xe1 ativo"\n                     }\n                  }\n               }\n            }\n         }\n      }\n    }\n});\n')),(0,r.kt)("h2",{id:"agora-\xe9-com-voc\xea"},"Agora \xe9 com voc\xea"),(0,r.kt)("p",null,"Aplique os ajustes necess\xe1rios para inserir o seguinte documento na cole\xe7\xe3o de ",(0,r.kt)("inlineCode",{parentName:"p"},"setores"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    nome: "Tecnologia e Engenharia",\n    sigla: "GTE",\n    funcionarios: [\n        {\n            nome: "Pedro Antunes Silva Barros",\n            cargo: "Estagi\xe1rio",\n            modulo: 0,\n            salario: 2200.00,\n            dataContratacao: "21/10/2021",\n            ativo: true\n        },\n        {            \n            nome: "Caroline Gouvea do Prado",\n            cargo: "Desenvolvedor FullStack",\n            modulo: "4",\n            salario: "18246.78",\n            dataContratacao: "01/02/2011",\n            ativo: true\n        },\n        {            \n            nome: "Alisson Mendon\xe7a Pereira",\n            cargo: "Analista de DevOps",\n            modulo: "2",\n            salario: "8451.89",\n            dataContratacao: "07/07/2018",\n            ativo: true\n        },\n    ]\n}\n')),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Resposta sugerida"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'db.setores.insertOne(\n{\n    _id: 3,\n    nome: "Tecnologia e Engenharia",\n    sigla: "GTE",\n    funcionarios: [\n        {\n            _id: 5,\n            nome: "Pedro Antunes Silva Barros",\n            cargo: "Estagi\xe1rio",\n            modulo: 0,\n            salario: Double(2200.00),\n            dataContratacao: new ISODate("2021-10-21"),\n            ativo: true\n        },\n        {            \n            _id: 6,\n            nome: "Caroline Gouvea do Prado",\n            cargo: "Desenvolvedor FullStack",\n            modulo: 4,\n            salario: 18246.78,\n            dataContratacao: new ISODate("2011-02-01"),\n            ativo: true\n        },\n        {          \n            _id: 7,  \n            nome: "Alisson Mendon\xe7a Pereira",\n            cargo: "Analista de DevOps",\n            modulo: 2,\n            salario: 8451.89,\n            dataContratacao: new ISODate("2018-07-07"),\n            ativo: true\n        },\n    ]\n});\n'))),(0,r.kt)("h2",{id:"exerc\xedcios-propostos"},"Exerc\xedcios Propostos"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Fa\xe7a uma busca por todos os funcion\xe1rios onde os seguintes crit\xe9rios devem ser atendidos:",(0,r.kt)("ol",null,(0,r.kt)("li",null,"Filtrar os funcion\xe1rios onde o m\xeas de contrata\xe7\xe3o corresponda a outubro."),(0,r.kt)("li",null,"A sa\xedda deve estar ordenada pela `sigla` do setor e pelo nome do funcion\xe1rio."),(0,r.kt)("li",null,"Deve ser exibido apenas o nome do funcion\xe1rio e o setor correspondente.")))),(0,r.kt)("p",null,"Segue um exemplo da sa\xedda esperada:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        nome: "Pedro Antunes Silva Barros",\n        setor: "Tecnologia e Engenharia"\n    },\n    {\n        nome: "Anderson Campos Monteiro",\n        setor: "Recursos Humanos"\n    }\n]\n')),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Poss\xedvel solu\xe7\xe3o"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'db.setores.aggregate(\n  {\n      $unwind: "$funcionarios"\n  },{\n    $match: {\n        $expr: {\n            $eq: [{ $month: "$funcionarios.dataContratacao" }, 10] \n        }\n    }\n  },{\n      $sort: { sigla: 1, "funcionarios.nome": 1 }\n  },{\n    $project: {\n        _id: 0,\n        nome: "$funcionarios.nome",\n        setor: "$nome"\n    }\n  }\n);\n'))))}u.isMDXComponent=!0}}]);